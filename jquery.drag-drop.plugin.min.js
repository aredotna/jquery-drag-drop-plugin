(function(e){function a(e){i!=null&&(e.dropClass&&i.removeClass(e.dropClass),i=null),r!=null&&e.canDropClass&&r.removeClass(e.canDropClass)}var t={makeClone:!1,sourceClass:null,sourceHide:!1,dragClass:null,canDropClass:null,dropClass:null,isActive:!0,container:null,canDrag:function(e,t){return e},canDrop:function(e){return e.hasClass("drop")||e.parents(".drop").size()>0},didDrop:function(e,t){e.appendTo(t)}},n=null,r=null,i=null,s,o,u,f={init:function(n){return n=e.extend({},t,n),this.data("options",n),this.bind("mousedown.dragdrop touchstart.dragdrop",f.onStart),this},destroy:function(){return this.unbind("mousedown.dragdrop touchstart.dragdrop"),this},on:function(){this.data("options").isActive=!0},off:function(){this.data("options").isActive=!1},onStart:function(t){function a(){e(this).unbind(i)}function l(){e(this).unbind(i);var a=e(this),l=a.data("options");if(!l.isActive)return;var c=l.canDrag(a,t);if(c){n=c;var h=n.offset(),p=n.width(),d=n.height();t.type=="touchstart"?(s=t.originalEvent
.touches[0].clientX-h.left,o=t.originalEvent.touches[0].clientY-h.top):(s=t.pageX-h.left,o=t.pageY-h.top),l.makeClone?(r=n.clone(!1),r.appendTo(c.parent()),l.sourceClass?n.addClass(l.sourceClass):l.sourceHide&&n.css("visibility","hidden")):r=n,r.css({position:"absolute",left:h.left,top:h.top,width:p,height:d}),l.dragClass&&r.addClass(l.dragClass);var v=l.container;if(v){var h=v.offset();u={minX:h.left,minY:h.top,maxX:h.left+v.outerWidth()-c.outerWidth(),maxY:h.top+v.outerHeight()-c.outerHeight()}}return e(window).bind("mousemove.dragdrop touchmove.dragdrop",{source:a},f.onMove).bind("mouseup.dragdrop touchend.dragdrop",{source:a},f.onEnd),t.stopPropagation(),!1}}var i={"mousemove touchmove":l,"mouseup touchend":a};return e(this).bind(i),t.stopPropagation(),!1},onMove:function(t){if(!r)return;var n=t.data.source,f=n.data("options"),l,c;t.type=="touchmove"?(l=t.originalEvent.touches[0].clientX,c=t.originalEvent.touches[0].clientY):(l=t.pageX,c=t.pageY),r.css("display","none");var h=document
.elementFromPoint(l-document.documentElement.scrollLeft-document.body.scrollLeft,c-document.documentElement.scrollTop-document.body.scrollTop);r.css("display",""),l-=s,c-=o,u&&(l=Math.min(Math.max(l,u.minX),u.maxX),c=Math.min(Math.max(c,u.minY),u.maxY)),r.css({left:l,top:c}),h=f.canDrop(h);if(h){if(i==null||!i.is(h)){var p=e(h);f.canDrop(p)?(f.dropClass&&(i!=null&&i.removeClass(f.dropClass),p.addClass(f.dropClass)),f.canDropClass&&r.addClass(f.canDropClass),i=p):i!=null&&a(f)}}else i!=null&&a(f);return t.stopPropagation(),!1},onEnd:function(t){if(!r)return;var s=t.data.source,o=s.data("options");i&&o.didDrop(n,i),a(o),o.makeClone?(r.remove(),o.sourceClass?n.removeClass(o.sourceClass):o.sourceHide&&n.css("visibility","visible")):(r.css("position","static"),r.css("width",""),r.css("height",""),o.dragClass&&r.removeClass(o.dragClass)),e(window).unbind("mousemove.dragdrop touchmove.dragdrop"),e(window).unbind("mouseup.dragdrop touchend.dragdrop"),n=r=u=null}};e.fn.dragdrop=function(t){if(f[
t])return f[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return f.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.dragdrop")}})(jQuery);